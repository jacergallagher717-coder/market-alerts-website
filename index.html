<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Impact Pro - Real-Time Trade Alerts Powered by AI</title>
    <meta name="description" content="Get trade-ready analysis within seconds of market-moving headlines. AI-powered alerts from CNBC, Fed, earnings, and more.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', sans-serif; }
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); }
        .gradient-text { background: linear-gradient(135deg, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .card { animation: fadeIn 0.5s ease-out; transition: all 0.3s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3); }
        .live-pulse { animation: pulse 2s infinite; }
        .new-alert { animation: slideIn 0.4s ease-out; }
        .filter-chip { transition: all 0.2s; cursor: pointer; }
        .filter-chip:hover { transform: scale(1.05); }
        .filter-chip.active { background: linear-gradient(135deg, #3b82f6, #8b5cf6); }
        .alert-details { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .alert-details.expanded { max-height: 2000px; }
        .tab-btn { cursor: pointer; transition: all 0.2s; }
        .tab-btn.active { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        .lesson-card { transition: all 0.3s; cursor: pointer; }
        .lesson-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4); }
        .quiz-option { transition: all 0.2s; cursor: pointer; }
        .quiz-option:hover { background: rgba(59, 130, 246, 0.2); }
        .quiz-option.correct { background: rgba(34, 197, 94, 0.2); border-color: #22c55e; }
        .quiz-option.incorrect { background: rgba(239, 68, 68, 0.2); border-color: #ef4444; }
        .progress-bar { height: 8px; background: rgba(148, 163, 184, 0.2); border-radius: 9999px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); transition: width 0.5s; }
        .lesson-complete { position: relative; }
        .lesson-complete::after { content: '‚úì'; position: absolute; top: 10px; right: 10px; background: #22c55e; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .calculator-input { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(148, 163, 184, 0.3); color: white; padding: 12px; border-radius: 8px; }
        .calculator-input:focus { outline: none; border-color: #3b82f6; }
        .video-card { position: relative; overflow: hidden; cursor: pointer; }
        .video-card::before { content: '‚ñ∂'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 48px; color: white; z-index: 10; opacity: 0.8; }
        .video-card:hover::before { opacity: 1; }
        
        /* Auth Modal Styles */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 100; display: none; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-content { background: #1e293b; border-radius: 1rem; max-width: 28rem; width: 90%; padding: 2rem; border: 1px solid #334155; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
    </style>
</head>
<body class="text-white min-h-screen">
    
    <!-- Auth Modal -->
    <div id="authModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 class="text-2xl font-bold text-white" id="authTitle">Welcome Back</h2>
                    <p class="text-gray-400 text-sm" id="authSubtitle">Login to track your portfolio</p>
                </div>
                <button onclick="closeAuthModal()" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div id="authError" class="hidden bg-red-500/10 border border-red-500/50 rounded-lg p-3 mb-4">
                <p class="text-red-400 text-sm"></p>
            </div>
            
            <form onsubmit="handleAuth(event)" class="space-y-4">
                <div id="displayNameField" class="hidden">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Display Name (Optional)</label>
                    <input type="text" id="displayName" class="w-full px-4 py-3 bg-slate-800 border border-gray-700 rounded-lg text-white" placeholder="John Doe">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Email</label>
                    <input type="email" id="authEmail" required class="w-full px-4 py-3 bg-slate-800 border border-gray-700 rounded-lg text-white" placeholder="you@example.com">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="authPassword" required minlength="6" class="w-full px-4 py-3 bg-slate-800 border border-gray-700 rounded-lg text-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button type="submit" id="authSubmitBtn" class="w-full py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-600 hover:to-purple-700 transition">
                    Login
                </button>
            </form>
            
            <div class="mt-4 text-center">
                <button onclick="toggleAuthMode()" class="text-blue-400 hover:text-blue-300 text-sm" id="authToggle">
                    Don't have an account? Sign up
                </button>
            </div>
            
            <div class="mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                <p class="text-xs text-blue-300">üí° <strong>Pro Tip:</strong> Track trades & see your P&L!</p>
            </div>
        </div>
    </div>
    
    <!-- Exit Trade Modal -->
    <div id="exitTradeModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Exit Trade</h2>
                    <p class="text-gray-400 text-sm">Close this position</p>
                </div>
                <button onclick="closeExitTradeModal()" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <form onsubmit="submitExitTrade(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Exit Price *</label>
                    <input type="number" step="0.01" id="exitPrice" required class="w-full px-4 py-3 bg-slate-800 border border-gray-700 rounded-lg text-white" placeholder="125.50">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Notes (Optional)</label>
                    <textarea id="exitNotes" rows="3" class="w-full px-4 py-3 bg-slate-800 border border-gray-700 rounded-lg text-white" placeholder="Why did you exit this trade?"></textarea>
                </div>
                
                <button type="submit" class="w-full py-3 bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold rounded-lg hover:from-green-600 hover:to-green-700 transition">
                    Close Position
                </button>
            </form>
        </div>
    </div>
    
    <!-- Header -->
    <header class="glass sticky top-0 z-40 border-b border-slate-700/50 shadow-2xl">

    <!-- Header -->
    <header class="glass sticky top-0 z-40 border-b border-slate-700/50 shadow-2xl">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-3 rounded-xl shadow-lg">
                        <svg class="w-8 h-8" fill="white" viewBox="0 0 24 24">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-black gradient-text">Market Impact Pro</h1>
                        <p class="text-xs text-slate-400 font-medium">AI-Powered Trade Intelligence</p>
                    </div>
                </div>
                
                <!-- Navigation -->
                <nav class="hidden md:flex items-center gap-6">
                    <a href="#alerts" onclick="showSection('alerts')" class="hover:text-blue-400 font-semibold transition cursor-pointer">Alerts</a>
                    <a href="#portfolio" onclick="showPortfolio()" class="hover:text-blue-400 font-semibold transition cursor-pointer">üìä Portfolio</a>
                    <a href="#education" onclick="showSection('education')" class="hover:text-blue-400 font-semibold transition cursor-pointer">Learn</a>
                    <div class="flex items-center gap-3">
                        <div class="bg-green-500/20 border border-green-500/40 px-3 py-1.5 rounded-full flex items-center gap-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full live-pulse"></span>
                            <span class="text-green-400 font-bold text-xs">LIVE</span>
                        </div>
                        <div class="bg-slate-800/50 px-3 py-1.5 rounded-full text-xs font-semibold">
                            <span id="countNum">0</span> alerts today
                        </div>
                    </div>
                    
                    <!-- Auth Button / User Menu -->
                    <div id="authButtonContainer">
                        <button onclick="openAuthModal()" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-600 hover:to-purple-700 transition">
                            Login / Sign Up
                        </button>
                    </div>
                    
                    <div id="userMenuContainer" class="hidden relative">
                        <button onclick="toggleUserMenu()" class="flex items-center space-x-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition">
                            <div id="userAvatar" class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold">
                                U
                            </div>
                            <span id="userName" class="text-white text-sm">User</span>
                        </button>
                        
                        <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-lg border border-gray-700 py-2">
                            <div class="px-4 py-2 border-b border-gray-700">
                                <p class="text-xs text-gray-400">Signed in as</p>
                                <p id="userEmail" class="text-sm font-medium text-white truncate">user@example.com</p>
                            </div>
                            <button onclick="logout()" class="block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700 transition">
                                üö™ Logout
                            </button>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="max-w-7xl mx-auto px-6 py-16">
        <div class="text-center max-w-4xl mx-auto">
            <h2 class="text-6xl font-black mb-6 leading-tight">
                Get Trade-Ready Analysis<br/>
                <span class="gradient-text">Within Seconds</span> of Headlines
            </h2>
            <p class="text-2xl text-slate-400 mb-8">
                AI-powered alerts from CNBC, Fed announcements, earnings reports, and market-moving news. Never miss an opportunity.
            </p>
            
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-8" id="signupSection">
                <button onclick="connectTelegram()" class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 px-8 py-4 rounded-xl font-bold text-lg shadow-xl transition-all hover:scale-105 flex items-center gap-3">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z"/></svg>
                    Connect Telegram ‚Ä¢ Free
                </button>
                <input type="email" placeholder="Enter your email" class="bg-slate-800/50 border border-slate-700 px-6 py-4 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:border-blue-500" id="emailInput">
            </div>
            
            <p class="text-sm text-slate-500">No credit card required ‚Ä¢ 20 alerts/month free tier</p>
            
            <!-- Stats Bar -->
            <div class="grid grid-cols-3 gap-6 mt-12 max-w-2xl mx-auto">
                <div class="text-center">
                    <div class="text-3xl font-black gradient-text">~8s</div>
                    <div class="text-sm text-slate-400 mt-1">Avg Latency</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-black gradient-text">3</div>
                    <div class="text-sm text-slate-400 mt-1">News Sources</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-black gradient-text" id="heroAlertCount">0</div>
                    <div class="text-sm text-slate-400 mt-1">Today's Alerts</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filters & Search -->
    <section class="max-w-7xl mx-auto px-6 mb-8" id="alerts">
        <div class="glass rounded-2xl p-6">
            <!-- Search & Sort -->
            <div class="flex flex-col lg:flex-row gap-4 items-center justify-between mb-4">
                <div class="flex-1 w-full lg:max-w-md">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Search by ticker, keyword..."
                        class="w-full bg-slate-800/50 border border-slate-700 px-4 py-3 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:border-blue-500"
                        onkeyup="filterAlerts()"
                    >
                </div>
                
                <div class="flex gap-3">
                    <select id="sortSelect" onchange="sortAlerts()" class="bg-slate-800 border border-slate-700 px-4 py-3 rounded-xl text-white focus:outline-none focus:border-blue-500 font-semibold">
                        <option value="newest">üïê Newest First</option>
                        <option value="oldest">‚è∞ Oldest First</option>
                        <option value="relevance">‚≠ê Most Relevant</option>
                    </select>
                    
                    <button onclick="loadAlerts(true)" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-xl font-semibold transition-all flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Refresh
                    </button>
                </div>
            </div>
            
            <!-- Category Filters -->
            <div class="mb-3">
                <div class="text-xs font-bold text-slate-400 mb-2">CATEGORY</div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="setFilter('category', 'all')" class="filter-chip active px-4 py-2 rounded-full font-semibold text-sm bg-slate-800" data-filter="all">
                        All
                    </button>
                    <button onclick="setFilter('category', 'macro')" class="filter-chip px-4 py-2 rounded-full font-semibold text-sm bg-slate-800" data-filter="macro">
                        üìä Macro
                    </button>
                    <button onclick="setFilter('category', 'sector')" class="filter-chip px-4 py-2 rounded-full font-semibold text-sm bg-slate-800" data-filter="sector">
                        üè≠ Sector
                    </button>
                    <button onclick="setFilter('category', 'commodity')" class="filter-chip px-4 py-2 rounded-full font-semibold text-sm bg-slate-800" data-filter="commodity">
                        ‚ö° Commodity
                    </button>
                </div>
            </div>
            
            <!-- Sector Filters -->
            <div>
                <div class="text-xs font-bold text-slate-400 mb-2">SECTOR</div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="setFilter('sector', 'all')" class="sector-chip active px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="all">
                        All Sectors
                    </button>
                    <button onclick="setFilter('sector', 'tech')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="tech">
                        üíª Tech/AI
                    </button>
                    <button onclick="setFilter('sector', 'pharma')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="pharma">
                        üíä Pharma
                    </button>
                    <button onclick="setFilter('sector', 'energy')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="energy">
                        ‚ö° Energy
                    </button>
                    <button onclick="setFilter('sector', 'finance')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="finance">
                        üè¶ Finance
                    </button>
                    <button onclick="setFilter('sector', 'crypto')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="crypto">
                        ‚Çø Crypto
                    </button>
                    <button onclick="setFilter('sector', 'housing')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="housing">
                        üè† Housing
                    </button>
                    <button onclick="setFilter('sector', 'commodities')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="commodities">
                        üì¶ Commodities
                    </button>
                    <button onclick="setFilter('sector', 'retail')" class="sector-chip px-3 py-1.5 rounded-full text-xs font-semibold bg-slate-800" data-sector="retail">
                        üõçÔ∏è Retail
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Live Feed -->
    <main class="max-w-7xl mx-auto px-6 pb-16">
        <div class="mb-6 flex items-center justify-between">
            <h3 class="text-3xl font-black">Live Market Alerts</h3>
            <div class="text-sm text-slate-400">
                Updated <span id="updateTime">just now</span>
            </div>
        </div>
        <div id="alertsContainer" class="space-y-4">
            <div class="flex items-center justify-center py-20">
                <div class="animate-spin w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full"></div>
            </div>
        </div>
    </main>

    <!-- Portfolio Section -->
    <section class="max-w-7xl mx-auto px-6 py-16 border-t border-slate-800" id="portfolio" style="display: none;">
        <div class="text-center mb-12">
            <h2 class="text-5xl font-black mb-4">üìä My Portfolio</h2>
            <p class="text-xl text-slate-400">Track your trade ideas and performance</p>
        </div>

        <div id="portfolioContainer" class="space-y-4">
            <div class="glass rounded-2xl p-16 text-center">
                <div class="text-8xl mb-6">üìä</div>
                <h3 class="text-3xl font-black mb-3">No Trades Yet</h3>
                <p class="text-xl text-slate-400 mb-6">Start adding trade ideas from the alerts below!</p>
                <button onclick="showSection('alerts')" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition">
                    Browse Alerts
                </button>
            </div>
        </div>
    </section>

    <!-- Education Center -->
    <section class="max-w-7xl mx-auto px-6 py-16 border-t border-slate-800" id="education">
        <div class="text-center mb-12">
            <h2 class="text-5xl font-black mb-4">üìö Trading Academy</h2>
            <p class="text-xl text-slate-400">Master the fundamentals of market impact analysis</p>
        </div>

        <!-- Progress Dashboard -->
        <div class="glass rounded-2xl p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold">Your Progress</h3>
                <button onclick="resetProgress()" class="text-sm text-slate-400 hover:text-white transition">Reset Progress</button>
            </div>
            
            <div class="grid md:grid-cols-4 gap-4 mb-6">
                <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                    <div class="text-3xl font-black gradient-text" id="totalProgress">0%</div>
                    <div class="text-sm text-slate-400 mt-1">Overall Progress</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                    <div class="text-3xl font-black text-blue-400" id="lessonsCompleted">0/16</div>
                    <div class="text-sm text-slate-400 mt-1">Lessons Completed</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                    <div class="text-3xl font-black text-green-400" id="quizzesPassed">0/4</div>
                    <div class="text-sm text-slate-400 mt-1">Quizzes Passed</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4 text-center">
                    <div class="text-3xl font-black text-purple-400" id="videosWatched">0/12</div>
                    <div class="text-sm text-slate-400 mt-1">Videos Watched</div>
                </div>
            </div>

            <div class="space-y-3">
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>Fundamentals</span>
                        <span class="text-slate-400" id="prog-fundamentals">0/4</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="bar-fundamentals" style="width: 0%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>Event Analysis</span>
                        <span class="text-slate-400" id="prog-analysis">0/4</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="bar-analysis" style="width: 0%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>Trading Strategies</span>
                        <span class="text-slate-400" id="prog-trading">0/4</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="bar-trading" style="width: 0%"></div>
                    </div>
                </div>
                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span>Options Trading</span>
                        <span class="text-slate-400" id="prog-options">0/4</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="bar-options" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Course Tabs -->
        <div class="glass rounded-2xl p-6 mb-8">
            <div class="flex flex-wrap gap-4 border-b border-slate-700 pb-4 mb-6">
                <button onclick="showCourse('fundamentals')" class="tab-btn active px-6 py-3 font-bold" data-tab="fundamentals">
                    üìñ Fundamentals
                </button>
                <button onclick="showCourse('analysis')" class="tab-btn px-6 py-3 font-bold" data-tab="analysis">
                    üîç Event Analysis
                </button>
                <button onclick="showCourse('trading')" class="tab-btn px-6 py-3 font-bold" data-tab="trading">
                    üìà Trading Strategies
                </button>
                <button onclick="showCourse('options')" class="tab-btn px-6 py-3 font-bold" data-tab="options">
                    üìä Options Trading
                </button>
                <button onclick="showCourse('risk')" class="tab-btn px-6 py-3 font-bold" data-tab="risk">
                    ‚ö†Ô∏è Risk Management
                </button>
                <button onclick="showCourse('calculator')" class="tab-btn px-6 py-3 font-bold" data-tab="calculator">
                    üßÆ Calculator
                </button>
                <button onclick="showCourse('videos')" class="tab-btn px-6 py-3 font-bold" data-tab="videos">
                    üé• Videos
                </button>
            </div>

            <!-- Fundamentals Course -->
            <div id="course-fundamentals" class="tab-content active">
                <div class="space-y-6">
                    <!-- Lesson 1 -->
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-2xl font-bold mb-4">Lesson 1: What is Market Impact?</h3>
                        <div class="space-y-4 text-slate-300">
                            <p class="leading-relaxed">
                                <strong class="text-white">Market impact</strong> refers to how news events, economic data, and corporate announcements affect asset prices. Understanding this helps traders anticipate price movements and position accordingly.
                            </p>
                            
                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                                <h4 class="font-bold text-blue-300 mb-2">üí° Key Concept</h4>
                                <p>Not all news is equal. The market impact depends on:</p>
                                <ul class="list-disc list-inside mt-2 space-y-1 ml-4">
                                    <li>Surprise factor (actual vs. expected)</li>
                                    <li>Relevance to current market narrative</li>
                                    <li>Timing and liquidity conditions</li>
                                    <li>Credibility of the source</li>
                                </ul>
                            </div>

                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <h4 class="font-bold mb-3">üìä Example: Federal Reserve Rate Decision</h4>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div class="bg-green-900/20 border border-green-500/30 rounded p-3">
                                        <div class="font-bold text-green-400 mb-1">High Impact Scenario</div>
                                        <p class="text-sm">Fed cuts rates by 50bps when market expected 25bps ‚Üí Major market rally</p>
                                    </div>
                                    <div class="bg-red-900/20 border border-red-500/30 rounded p-3">
                                        <div class="font-bold text-red-400 mb-1">Low Impact Scenario</div>
                                        <p class="text-sm">Fed holds rates as expected ‚Üí Minimal price movement</p>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                                <h4 class="font-bold text-purple-300 mb-3">‚úèÔ∏è Practice Exercise</h4>
                                <p class="mb-3">Which event would likely have the HIGHEST market impact?</p>
                                <div class="space-y-2" id="quiz1">
                                    <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3 hover:border-blue-500" onclick="checkAnswer(1, 'A', false)">
                                        A) Company announces quarterly earnings in-line with expectations
                                    </div>
                                    <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3 hover:border-blue-500" onclick="checkAnswer(1, 'B', false)">
                                        B) CEO of small-cap company does routine interview
                                    </div>
                                    <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3 hover:border-blue-500" onclick="checkAnswer(1, 'C', true)">
                                        C) Fed Chair signals unexpected policy shift in major speech
                                    </div>
                                    <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3 hover:border-blue-500" onclick="checkAnswer(1, 'D', false)">
                                        D) Trade volume increases 5% on a Tuesday
                                    </div>
                                </div>
                                <div id="answer1" class="mt-3 hidden"></div>
                                <button onclick="completeLesson('fundamentals', 0)" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition text-sm">
                                    Mark Lesson Complete
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Lesson 2 -->
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-2xl font-bold mb-4">Lesson 2: Types of Market-Moving Events</h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-500/30 rounded-lg p-4">
                                <div class="text-3xl mb-2">üìä</div>
                                <h4 class="font-bold mb-2">Macro Events</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Fed decisions</li>
                                    <li>‚Ä¢ Jobs reports</li>
                                    <li>‚Ä¢ GDP data</li>
                                    <li>‚Ä¢ CPI/inflation</li>
                                </ul>
                            </div>
                            <div class="bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-500/30 rounded-lg p-4">
                                <div class="text-3xl mb-2">üè¢</div>
                                <h4 class="font-bold mb-2">Corporate Events</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Earnings reports</li>
                                    <li>‚Ä¢ M&A announcements</li>
                                    <li>‚Ä¢ Product launches</li>
                                    <li>‚Ä¢ Management changes</li>
                                </ul>
                            </div>
                            <div class="bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-500/30 rounded-lg p-4">
                                <div class="text-3xl mb-2">üåç</div>
                                <h4 class="font-bold mb-2">Geopolitical</h4>
                                <ul class="text-sm text-slate-300 space-y-1">
                                    <li>‚Ä¢ Elections</li>
                                    <li>‚Ä¢ Trade deals</li>
                                    <li>‚Ä¢ Conflicts</li>
                                    <li>‚Ä¢ Regulations</li>
                                </ul>
                            </div>
                        </div>
                        <button onclick="completeLesson('fundamentals', 1)" class="mt-6 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition text-sm">
                            Mark Lesson Complete
                        </button>
                    </div>
                </div>
            </div>

            <!-- Event Analysis Course -->
            <div id="course-analysis" class="tab-content">
                <div class="space-y-6">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-2xl font-bold mb-4">Lesson 1: Reading Between the Lines</h3>
                        <p class="text-slate-300 mb-4">
                            The headline is just the start. Professional traders analyze the full context, implications, and second-order effects.
                        </p>
                        
                        <div class="bg-slate-800/50 rounded-lg p-4 mb-4">
                            <h4 class="font-bold mb-3">üéØ Analysis Framework</h4>
                            <div class="space-y-3">
                                <div class="flex gap-3">
                                    <div class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">1</div>
                                    <div>
                                        <div class="font-bold">Identify the Event Type</div>
                                        <div class="text-sm text-slate-400">Macro, sector-specific, or company news?</div>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <div class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">2</div>
                                    <div>
                                        <div class="font-bold">Assess the Surprise Factor</div>
                                        <div class="text-sm text-slate-400">Expected vs. actual outcome</div>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <div class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">3</div>
                                    <div>
                                        <div class="font-bold">Map Affected Assets</div>
                                        <div class="text-sm text-slate-400">Direct and indirect correlations</div>
                                    </div>
                                </div>
                                <div class="flex gap-3">
                                    <div class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold flex-shrink-0">4</div>
                                    <div>
                                        <div class="font-bold">Determine Time Horizon</div>
                                        <div class="text-sm text-slate-400">Immediate, short-term, or long-term impact?</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                            <h4 class="font-bold text-green-300 mb-3">üìö Case Study: Tech Earnings Beat</h4>
                            <p class="text-sm text-slate-300 mb-3">
                                <strong>Headline:</strong> "Microsoft beats Q3 earnings on cloud growth"
                            </p>
                            <div class="space-y-2 text-sm">
                                <div><strong class="text-white">Direct Impact:</strong> MSFT stock likely gaps up 3-5%</div>
                                <div><strong class="text-white">Sector Impact:</strong> Cloud competitors (AMZN, GOOGL) may rally on sector strength</div>
                                <div><strong class="text-white">Indirect Impact:</strong> SaaS companies benefit from validation of cloud spending trends</div>
                                <div><strong class="text-white">Contrarian Take:</strong> If MSFT guided lower despite beat, rally may fade</div>
                            </div>
                        </div>

                        <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4 mt-4">
                            <h4 class="font-bold text-purple-300 mb-3">‚úèÔ∏è Practice Quiz</h4>
                            <p class="mb-3">A pharmaceutical company announces FDA approval for a major drug. Which asset is LEAST likely to be affected?</p>
                            <div class="space-y-2" id="quiz3">
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(3, 'A', false)">
                                    A) Competing pharma companies with similar drug pipelines
                                </div>
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(3, 'B', false)">
                                    B) Healthcare ETFs with exposure to the company
                                </div>
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(3, 'C', true)">
                                    C) Unrelated commodity like copper futures
                                </div>
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(3, 'D', false)">
                                    D) Insurance companies that will cover the drug
                                </div>
                            </div>
                            <div id="answer3" class="mt-3 hidden"></div>
                            <button onclick="completeLesson('analysis', 0)" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition text-sm">
                                Mark Lesson Complete
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trading Strategies Course -->
            <div id="course-trading" class="tab-content">
                <div class="space-y-6">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-2xl font-bold mb-4">Lesson 1: Event-Driven Trading Strategies</h3>
                        
                        <div class="grid md:grid-cols-2 gap-4 mb-6">
                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                                <h4 class="font-bold text-blue-300 mb-2">üéØ Momentum Trading</h4>
                                <p class="text-sm text-slate-300 mb-2">Ride the initial reaction to news</p>
                                <div class="text-xs space-y-1 text-slate-400">
                                    <div>‚úì Best for: High-confidence, clear directional news</div>
                                    <div>‚úì Entry: Within 30 seconds of news</div>
                                    <div>‚úì Exit: 5-30 minutes (take profit fast)</div>
                                </div>
                            </div>
                            
                            <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                                <h4 class="font-bold text-purple-300 mb-2">üîÑ Mean Reversion</h4>
                                <p class="text-sm text-slate-300 mb-2">Fade overreactions to news</p>
                                <div class="text-xs space-y-1 text-slate-400">
                                    <div>‚úì Best for: Overhyped or misunderstood news</div>
                                    <div>‚úì Entry: After initial spike/drop settles</div>
                                    <div>‚úì Exit: When price returns to pre-news levels</div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-800/50 rounded-lg p-4">
                            <h4 class="font-bold mb-3">‚öôÔ∏è Strategy Selection Guide</h4>
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-slate-700">
                                        <th class="text-left pb-2">News Type</th>
                                        <th class="text-left pb-2">Best Strategy</th>
                                        <th class="text-left pb-2">Risk Level</th>
                                    </tr>
                                </thead>
                                <tbody class="text-slate-300">
                                    <tr class="border-b border-slate-700/50">
                                        <td class="py-2">Surprise earnings beat</td>
                                        <td class="py-2">Momentum (buy)</td>
                                        <td class="py-2 text-green-400">Medium</td>
                                    </tr>
                                    <tr class="border-b border-slate-700/50">
                                        <td class="py-2">Expected Fed decision</td>
                                        <td class="py-2">No trade</td>
                                        <td class="py-2 text-slate-500">N/A</td>
                                    </tr>
                                    <tr class="border-b border-slate-700/50">
                                        <td class="py-2">Overblown headline</td>
                                        <td class="py-2">Mean reversion</td>
                                        <td class="py-2 text-yellow-400">Medium-High</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2">M&A announcement</td>
                                        <td class="py-2">Momentum + pairs trade</td>
                                        <td class="py-2 text-red-400">High</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4 mt-4">
                            <h4 class="font-bold text-purple-300 mb-3">‚úèÔ∏è Quick Quiz</h4>
                            <p class="mb-3">You expect Tesla to beat earnings but only moderately. Which strategy minimizes risk while capturing upside?</p>
                            <div class="space-y-2" id="quiz4">
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(4, 'A', false)">
                                    A) Buy deep OTM calls for maximum leverage
                                </div>
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(4, 'B', true)">
                                    B) Bull call spread (buy ATM call, sell OTM call)
                                </div>
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(4, 'C', false)">
                                    C) Sell naked puts for premium collection
                                </div>
                                <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(4, 'D', false)">
                                    D) Buy straddle expecting huge move either way
                                </div>
                            </div>
                            <div id="answer4" class="mt-3 hidden"></div>
                            <button onclick="completeLesson('trading', 0)" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition text-sm">
                                Mark Lesson Complete
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Options Trading Course -->
            <div id="course-options" class="tab-content">
                <div class="space-y-6">
                    <!-- Lesson 1: Options Basics -->
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-2xl font-bold mb-4">Lesson 1: What Are Options?</h3>
                        <div class="space-y-4 text-slate-300">
                            <p class="leading-relaxed">
                                Options are contracts that give you the <strong class="text-white">right, but not the obligation</strong>, to buy or sell an asset at a specific price before a certain date.
                            </p>
                            
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                                    <h4 class="font-bold text-green-300 mb-2 flex items-center gap-2">
                                        <span class="text-2xl">üìû</span>
                                        Call Option
                                    </h4>
                                    <p class="text-sm mb-2">Right to <strong>BUY</strong> stock at strike price</p>
                                    <div class="text-xs space-y-1">
                                        <div>‚úì Profit when stock goes UP</div>
                                        <div>‚úì Bullish strategy</div>
                                        <div>‚úì Max loss = premium paid</div>
                                    </div>
                                </div>
                                
                                <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4">
                                    <h4 class="font-bold text-red-300 mb-2 flex items-center gap-2">
                                        <span class="text-2xl">üìâ</span>
                                        Put Option
                                    </h4>
                                    <p class="text-sm mb-2">Right to <strong>SELL</strong> stock at strike price</p>
                                    <div class="text-xs space-y-1">
                                        <div>‚úì Profit when stock goes DOWN</div>
                                        <div>‚úì Bearish strategy</div>
                                        <div>‚úì Max loss = premium paid</div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                                <h4 class="font-bold text-blue-300 mb-2">üîë Key Terms</h4>
                                <div class="grid md:grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <strong class="text-white">Strike Price:</strong> The price at which you can buy/sell
                                    </div>
                                    <div>
                                        <strong class="text-white">Premium:</strong> Cost to buy the option
                                    </div>
                                    <div>
                                        <strong class="text-white">Expiration:</strong> Last day option is valid
                                    </div>
                                    <div>
                                        <strong class="text-white">In-the-Money (ITM):</strong> Option has intrinsic value
                                    </div>
                                    <div>
                                        <strong class="text-white">At-the-Money (ATM):</strong> Strike ‚âà stock price
                                    </div>
                                    <div>
                                        <strong class="text-white">Out-of-the-Money (OTM):</strong> No intrinsic value
                                    </div>
                                </div>
                            </div>

                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <h4 class="font-bold mb-3">üìö Example: Buying a Call Option</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between border-b border-slate-700 pb-2">
                                        <span>Stock Price (AAPL):</span>
                                        <span class="font-bold">$150</span>
                                    </div>
                                    <div class="flex justify-between border-b border-slate-700 pb-2">
                                        <span>Buy Call Option:</span>
                                        <span class="font-bold">$155 strike, 30 days</span>
                                    </div>
                                    <div class="flex justify-between border-b border-slate-700 pb-2">
                                        <span>Premium Paid:</span>
                                        <span class="font-bold text-red-400">$3.00 per share ($300 total)</span>
                                    </div>
                                    <div class="mt-3 space-y-2">
                                        <div class="bg-green-900/20 border border-green-500/30 rounded p-2">
                                            <strong class="text-green-300">If AAPL ‚Üí $165:</strong> Profit = ($165 - $155 - $3) √ó 100 = <strong>$700 gain</strong>
                                        </div>
                                        <div class="bg-red-900/20 border border-red-500/30 rounded p-2">
                                            <strong class="text-red-300">If AAPL stays at $150:</strong> Option expires worthless = <strong>$300 loss</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                                <h4 class="font-bold text-purple-300 mb-3">‚úèÔ∏è Quick Quiz</h4>
                                <p class="mb-3">You think Tesla will drop after earnings. Which option should you buy?</p>
                                <div class="space-y-2" id="quiz2">
                                    <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(2, 'A', false)">
                                        A) Call option - right to buy Tesla
                                    </div>
                                    <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(2, 'B', true)">
                                        B) Put option - right to sell Tesla
                                    </div>
                                    <div class="quiz-option bg-slate-800 border border-slate-700 rounded-lg p-3" onclick="checkAnswer(2, 'C', false)">
                                        C) Buy Tesla stock and hope for the best
                                    </div>
                                </div>
                                <div id="answer2" class="mt-3 hidden"></div>
                                <button onclick="completeLesson('options', 0)" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition text-sm">
                                    Mark Lesson Complete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Management Course -->
            <div id="course-risk" class="tab-content">
                <div class="space-y-6">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-2xl font-bold mb-4">Lesson 1: Position Sizing & Stop Losses</h3>
                        
                        <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4 mb-6">
                            <h4 class="font-bold text-red-300 mb-2">‚ö†Ô∏è Golden Rule</h4>
                            <p class="text-lg">Never risk more than 1-2% of your portfolio on a single news-driven trade.</p>
                        </div>

                        <div class="space-y-4">
                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <h4 class="font-bold mb-3">üìê Position Sizing Formula</h4>
                                <div class="bg-slate-900/50 rounded p-3 font-mono text-sm mb-3">
                                    Position Size = (Account Size √ó Risk %) / (Entry Price - Stop Loss)
                                </div>
                                <div class="text-sm text-slate-300">
                                    <strong>Example:</strong> $10,000 account, 1% risk ($100), stock at $50, stop at $48
                                    <br/>
                                    Position = $100 / ($50 - $48) = 50 shares
                                </div>
                            </div>

                            <div class="bg-slate-800/50 rounded-lg p-4">
                                <h4 class="font-bold mb-3">üõ°Ô∏è Stop Loss Guidelines for News Trading</h4>
                                <ul class="space-y-2 text-sm text-slate-300">
                                    <li class="flex gap-2">
                                        <span class="text-blue-400">‚Ä¢</span>
                                        <span><strong>Tight stops (1-2%):</strong> For momentum plays with high conviction</span>
                                    </li>
                                    <li class="flex gap-2">
                                        <span class="text-blue-400">‚Ä¢</span>
                                        <span><strong>Medium stops (3-5%):</strong> For swing trades based on fundamental shifts</span>
                                    </li>
                                    <li class="flex gap-2">
                                        <span class="text-blue-400">‚Ä¢</span>
                                        <span><strong>Wide stops (5-10%):</strong> For high-volatility events (earnings, Fed)</span>
                                    </li>
                                </ul>
                            </div>

                            <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">
                                <h4 class="font-bold text-yellow-300 mb-3">üí° Pro Tip: Time-Based Exits</h4>
                                <p class="text-sm text-slate-300">
                                    News-driven moves often exhaust within 30-60 minutes. Consider exiting profitable trades even without hitting your price target if momentum fades.
                                </p>
                            </div>

                            <button onclick="completeLesson('risk', 0)" class="mt-4 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition text-sm w-full md:w-auto">
                                Mark Lesson Complete
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calculator Course -->
            <div id="course-calculator" class="tab-content">
                <div class="glass rounded-xl p-6">
                    <h3 class="text-2xl font-bold mb-6">üßÆ Options Profit Calculator</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <!-- Input Section -->
                        <div class="space-y-4">
                            <h4 class="font-bold text-lg mb-4">Enter Your Trade Details</h4>
                            
                            <div>
                                <label class="block text-sm font-semibold mb-2">Option Type</label>
                                <select id="optionType" class="calculator-input w-full">
                                    <option value="call">Call Option</option>
                                    <option value="put">Put Option</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Current Stock Price ($)</label>
                                <input type="number" id="stockPrice" class="calculator-input w-full" placeholder="150.00" value="150">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Strike Price ($)</label>
                                <input type="number" id="strikePrice" class="calculator-input w-full" placeholder="155.00" value="155">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Premium Paid per Share ($)</label>
                                <input type="number" id="premium" class="calculator-input w-full" placeholder="3.00" value="3">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Number of Contracts</label>
                                <input type="number" id="contracts" class="calculator-input w-full" placeholder="1" value="1">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold mb-2">Target Stock Price ($)</label>
                                <input type="number" id="targetPrice" class="calculator-input w-full" placeholder="165.00" value="165">
                            </div>

                            <button onclick="calculateProfit()" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 px-6 py-3 rounded-xl font-bold w-full transition">
                                Calculate Profit/Loss
                            </button>
                        </div>

                        <!-- Results Section -->
                        <div class="space-y-4">
                            <h4 class="font-bold text-lg mb-4">Results</h4>
                            
                            <div id="calcResults" class="space-y-3">
                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <div class="text-sm text-slate-400 mb-1">Total Investment</div>
                                    <div class="text-2xl font-bold" id="totalInvestment">$0.00</div>
                                </div>

                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <div class="text-sm text-slate-400 mb-1">Breakeven Price</div>
                                    <div class="text-2xl font-bold" id="breakeven">$0.00</div>
                                </div>

                                <div class="bg-slate-800/50 rounded-lg p-4">
                                    <div class="text-sm text-slate-400 mb-1">Value at Target Price</div>
                                    <div class="text-2xl font-bold" id="targetValue">$0.00</div>
                                </div>

                                <div class="rounded-lg p-4" id="profitLossBox">
                                    <div class="text-sm text-slate-400 mb-1">Profit/Loss</div>
                                    <div class="text-3xl font-black" id="profitLoss">$0.00</div>
                                    <div class="text-sm mt-1" id="returnPct">0%</div>
                                </div>
                            </div>

                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                                <h5 class="font-bold text-blue-300 mb-2">üí° Quick Tips</h5>
                                <ul class="text-xs space-y-1 text-slate-300">
                                    <li>‚Ä¢ Each contract = 100 shares</li>
                                    <li>‚Ä¢ Calls profit when stock > strike + premium</li>
                                    <li>‚Ä¢ Puts profit when stock < strike - premium</li>
                                    <li>‚Ä¢ Max loss for buyers = premium paid</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Greeks Calculator -->
                    <div class="mt-8 border-t border-slate-700 pt-8">
                        <h4 class="font-bold text-lg mb-4">üìä Greeks Estimator (Simplified)</h4>
                        <div class="grid md:grid-cols-4 gap-4">
                            <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4 text-center">
                                <div class="text-sm text-slate-400 mb-2">Delta (Œî)</div>
                                <div class="text-2xl font-bold" id="deltaCalc">0.00</div>
                                <div class="text-xs text-slate-400 mt-1">Price sensitivity</div>
                            </div>
                            <div class="bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-center">
                                <div class="text-sm text-slate-400 mb-2">Theta (Œò)</div>
                                <div class="text-2xl font-bold" id="thetaCalc">-0.00</div>
                                <div class="text-xs text-slate-400 mt-1">Time decay/day</div>
                            </div>
                            <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4 text-center">
                                <div class="text-sm text-slate-400 mb-2">Gamma (Œì)</div>
                                <div class="text-2xl font-bold" id="gammaCalc">0.00</div>
                                <div class="text-xs text-slate-400 mt-1">Delta change</div>
                            </div>
                            <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4 text-center">
                                <div class="text-sm text-slate-400 mb-2">Max Risk</div>
                                <div class="text-2xl font-bold text-red-400" id="maxRisk">$0</div>
                                <div class="text-xs text-slate-400 mt-1">Premium paid</div>
                            </div>
                        </div>
                        <p class="text-xs text-slate-500 mt-4 text-center">Note: These are simplified estimates. Actual Greeks vary based on volatility, time to expiration, and other factors.</p>
                    </div>
                </div>
            </div>

            <!-- Video Tutorials -->
            <div id="course-videos" class="tab-content">
                <div class="space-y-6">
                    <div class="text-center mb-8">
                        <h3 class="text-3xl font-bold mb-2">üé• Video Tutorial Library</h3>
                        <p class="text-slate-400">Learn from expert traders with these comprehensive video guides</p>
                    </div>

                    <!-- Fundamentals Videos -->
                    <div>
                        <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>üìñ</span> Fundamentals Series
                        </h4>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('fund-1')">
                                <div class="bg-gradient-to-br from-blue-600 to-blue-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üìä</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Market Impact 101</h5>
                                    <p class="text-sm text-slate-400">Understanding how news moves markets</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-blue-600 px-2 py-1 rounded">12:30</span>
                                        <span class="text-xs text-slate-500" id="video-fund-1-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('fund-2')">
                                <div class="bg-gradient-to-br from-purple-600 to-purple-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üìà</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Reading Economic Data</h5>
                                    <p class="text-sm text-slate-400">CPI, jobs reports, GDP explained</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-purple-600 px-2 py-1 rounded">18:45</span>
                                        <span class="text-xs text-slate-500" id="video-fund-2-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('fund-3')">
                                <div class="bg-gradient-to-br from-green-600 to-green-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üè¢</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Earnings Season Guide</h5>
                                    <p class="text-sm text-slate-400">How to trade quarterly reports</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-green-600 px-2 py-1 rounded">15:20</span>
                                        <span class="text-xs text-slate-500" id="video-fund-3-status">Not watched</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Options Trading Videos -->
                    <div>
                        <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>üìä</span> Options Trading Series
                        </h4>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('opt-1')">
                                <div class="bg-gradient-to-br from-yellow-600 to-orange-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üìû</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Calls & Puts Explained</h5>
                                    <p class="text-sm text-slate-400">Master the basics of options</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-yellow-600 px-2 py-1 rounded">14:15</span>
                                        <span class="text-xs text-slate-500" id="video-opt-1-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('opt-2')">
                                <div class="bg-gradient-to-br from-red-600 to-pink-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üéØ</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Options Strategies</h5>
                                    <p class="text-sm text-slate-400">Spreads, straddles, and more</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-red-600 px-2 py-1 rounded">22:40</span>
                                        <span class="text-xs text-slate-500" id="video-opt-2-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('opt-3')">
                                <div class="bg-gradient-to-br from-indigo-600 to-purple-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üìâ</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">The Greeks Masterclass</h5>
                                    <p class="text-sm text-slate-400">Delta, theta, vega demystified</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-indigo-600 px-2 py-1 rounded">19:30</span>
                                        <span class="text-xs text-slate-500" id="video-opt-3-status">Not watched</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Topics -->
                    <div>
                        <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>üöÄ</span> Advanced Topics
                        </h4>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('adv-1')">
                                <div class="bg-gradient-to-br from-cyan-600 to-blue-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">‚ö°</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">News Trading Tactics</h5>
                                    <p class="text-sm text-slate-400">Execute trades within seconds</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-cyan-600 px-2 py-1 rounded">16:55</span>
                                        <span class="text-xs text-slate-500" id="video-adv-1-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('adv-2')">
                                <div class="bg-gradient-to-br from-rose-600 to-red-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">‚ö†Ô∏è</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Risk Management Deep Dive</h5>
                                    <p class="text-sm text-slate-400">Protect your capital</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-rose-600 px-2 py-1 rounded">21:10</span>
                                        <span class="text-xs text-slate-500" id="video-adv-2-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('adv-3')">
                                <div class="bg-gradient-to-br from-emerald-600 to-green-800 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üí∞</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Building a Trading Plan</h5>
                                    <p class="text-sm text-slate-400">From strategy to execution</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-emerald-600 px-2 py-1 rounded">24:30</span>
                                        <span class="text-xs text-slate-500" id="video-adv-3-status">Not watched</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Live Trading Sessions -->
                    <div>
                        <h4 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>üî¥</span> Live Trading Sessions
                        </h4>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('live-1')">
                                <div class="bg-gradient-to-br from-orange-600 to-red-700 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üéôÔ∏è</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Trading FOMC Decisions</h5>
                                    <p class="text-sm text-slate-400">Real-time Fed announcement trade</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-orange-600 px-2 py-1 rounded">45:20</span>
                                        <span class="text-xs text-slate-500" id="video-live-1-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('live-2')">
                                <div class="bg-gradient-to-br from-violet-600 to-purple-700 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üíº</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Earnings Season Breakdown</h5>
                                    <p class="text-sm text-slate-400">Trading big tech earnings live</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-violet-600 px-2 py-1 rounded">38:15</span>
                                        <span class="text-xs text-slate-500" id="video-live-2-status">Not watched</span>
                                    </div>
                                </div>
                            </div>

                            <div class="video-card glass rounded-xl overflow-hidden" onclick="watchVideo('live-3')">
                                <div class="bg-gradient-to-br from-teal-600 to-cyan-700 h-40 flex items-center justify-center">
                                    <div class="text-6xl">üì°</div>
                                </div>
                                <div class="p-4">
                                    <h5 class="font-bold mb-1">Market Open Strategy</h5>
                                    <p class="text-sm text-slate-400">First 30 minutes trading plan</p>
                                    <div class="flex items-center gap-2 mt-2">
                                        <span class="text-xs bg-teal-600 px-2 py-1 rounded">32:50</span>
                                        <span class="text-xs text-slate-500" id="video-live-3-status">Not watched</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="mt-16 border-t border-slate-800 py-8">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <p class="text-slate-500 text-sm">‚ö†Ô∏è Not financial advice. For educational purposes only.</p>
                <div class="flex gap-6 text-sm text-slate-400">
                    <a href="#" class="hover:text-white">Terms</a>
                    <a href="#" class="hover:text-white">Privacy</a>
                    <a href="#" class="hover:text-white">Risk Disclosure</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        const API_URL = 'https://market-impact-bot-v2.onrender.com';
        
        // ==================== AUTH STATE ====================
        let currentUser = null;
        let authToken = null;
        let isLoginMode = true;
        
        // ==================== APP STATE ====================
        let allAlerts = [];
        let currentCategoryFilter = 'all';
        let currentSectorFilter = 'all';
        let currentSort = 'newest';
        let lastFetchTime = Date.now();
        
        // Progress tracking (in memory)
        let progress = {
            fundamentals: 0,
            analysis: 0,
            trading: 0,
            options: 0,
            risk: 0,
            quizzesPassed: 0,
            videosWatched: []
        };
        
        // Sector mapping for filtering
        const sectorMapping = {
            'tech': ['NVDA', 'AMD', 'MSFT', 'GOOGL', 'AAPL', 'TSM', 'ASML', 'SMCI', 'AVGO', 'INTC'],
            'pharma': ['PFE', 'JNJ', 'MRNA', 'ABBV', 'LLY'],
            'energy': ['XLE', 'OIL', 'XOM', 'CVX'],
            'finance': ['JPM', 'BAC', 'GS', 'MS', 'XLF', 'BX', 'ARES', 'SCHW'],
            'crypto': ['BTC', 'ETH', 'COIN'],
            'housing': ['XHB', 'DHI', 'LEN', 'PHM'],
            'commodities': ['GLD', 'SLV', 'NEM', 'GOLD'],
            'retail': ['AMZN', 'WMT', 'TGT', 'COST']
        };
        
        // ==================== SECTION NAVIGATION ====================
        
        function showSection(sectionId) {
            // Hide all sections
            document.getElementById('alerts').style.display = 'none';
            document.getElementById('portfolio').style.display = 'none';
            document.getElementById('education').style.display = 'none';
            
            // Show requested section
            if (sectionId === 'alerts') {
                document.getElementById('alerts').style.display = 'block';
                document.querySelector('main').style.display = 'block';
            } else if (sectionId === 'education') {
                document.getElementById('education').style.display = 'block';
            }

            // Start price updates for alerts and portfolio
    if (sectionId === 'alerts' || sectionId === 'portfolio') {
        startPriceUpdates();
    } else {
        stopPriceUpdates();
    }
        }
        
        // ==================== AUTH FUNCTIONS ====================
        
        function initAuth() {
            const storedToken = localStorage.getItem('auth_token');
            const storedUser = localStorage.getItem('user');
            
            if (storedToken && storedUser) {
                authToken = storedToken;
                currentUser = JSON.parse(storedUser);
                updateAuthUI();
            }
        }
        
        function openAuthModal() {
            document.getElementById('authModal').classList.add('active');
        }
        
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('authError').classList.add('hidden');
        }
        
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            
            if (isLoginMode) {
                document.getElementById('authTitle').textContent = 'Welcome Back';
                document.getElementById('authSubtitle').textContent = 'Login to track your portfolio';
                document.getElementById('authSubmitBtn').textContent = 'Login';
                document.getElementById('authToggle').textContent = "Don't have an account? Sign up";
                document.getElementById('displayNameField').classList.add('hidden');
            } else {
                document.getElementById('authTitle').textContent = 'Create Account';
                document.getElementById('authSubtitle').textContent = 'Start tracking your trade ideas';
                document.getElementById('authSubmitBtn').textContent = 'Create Account';
                document.getElementById('authToggle').textContent = 'Already have an account? Login';
                document.getElementById('displayNameField').classList.remove('hidden');
            }
        }
        
        async function handleAuth(e) {
            e.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const displayName = document.getElementById('displayName').value;
            
            const errorDiv = document.getElementById('authError');
            errorDiv.classList.add('hidden');
            
            try {
                const endpoint = isLoginMode ? '/api/auth/login' : '/api/auth/signup';
                const body = isLoginMode 
                    ? { email, password }
                    : { email, password, display_name: displayName };
                
                const response = await fetch(`${API_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.detail || 'Authentication failed');
                }
                
                const data = await response.json();
                authToken = data.token;
                currentUser = data.user;
                
                localStorage.setItem('auth_token', authToken);
                localStorage.setItem('user', JSON.stringify(currentUser));
                
                updateAuthUI();
                closeAuthModal();
                showToast(`Welcome ${currentUser.display_name || currentUser.email}! üéâ`);
                
                // Clear form
                document.getElementById('authEmail').value = '';
                document.getElementById('authPassword').value = '';
                document.getElementById('displayName').value = '';
                
            } catch (error) {
                errorDiv.querySelector('p').textContent = error.message;
                errorDiv.classList.remove('hidden');
            }
        }
        
        function updateAuthUI() {
            if (currentUser) {
                document.getElementById('authButtonContainer').classList.add('hidden');
                document.getElementById('userMenuContainer').classList.remove('hidden');
                
                const firstLetter = (currentUser.display_name || currentUser.email)[0].toUpperCase();
                document.getElementById('userAvatar').textContent = firstLetter;
                document.getElementById('userName').textContent = currentUser.display_name || currentUser.email.split('@')[0];
                document.getElementById('userEmail').textContent = currentUser.email;
            } else {
                document.getElementById('authButtonContainer').classList.remove('hidden');
                document.getElementById('userMenuContainer').classList.add('hidden');
            }
        }
        
        function toggleUserMenu() {
            document.getElementById('userMenu').classList.toggle('hidden');
        }
        
        function logout() {
            currentUser = null;
            authToken = null;
            localStorage.removeItem('auth_token');
            localStorage.removeItem('user');
            updateAuthUI();
            document.getElementById('userMenu').classList.add('hidden');
            showToast('Logged out successfully');
        }
        
        // ==================== PORTFOLIO FUNCTIONS ====================
        
        let currentTradeToExit = null;

        function openExitTradeModal(tradeId) {
            currentTradeToExit = tradeId;
            document.getElementById('exitTradeModal').classList.add('active');
            document.getElementById('exitPrice').value = '';
            document.getElementById('exitNotes').value = '';
        }

        function closeExitTradeModal() {
            currentTradeToExit = null;
            document.getElementById('exitTradeModal').classList.remove('active');
        }

        async function submitExitTrade(event) {
            event.preventDefault();
            
            if (!currentTradeToExit) return;
            
            const exitPrice = parseFloat(document.getElementById('exitPrice').value);
            const notes = document.getElementById('exitNotes').value;
            
            try {
                const response = await fetch(`${API_URL}/api/portfolio/${currentTradeToExit}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        exit_price: exitPrice,
                        status: 'closed',
                        notes: notes || undefined
                    })
                });
                
                if (!response.ok) {
                    const data = await response.json();
                    throw new Error(data.detail || 'Failed to exit trade');
                }
                
                showToast('‚úÖ Trade closed successfully!');
                closeExitTradeModal();
                loadPortfolio();
                
            } catch (error) {
                showToast('‚ùå ' + error.message);
                console.error('Exit trade error:', error);
            }
        }
        
        
        async function showPortfolio() {
            if (!authToken) {
                showToast('Please login to view portfolio');
                openAuthModal();
                return;
            }
            
            // Hide other sections
            document.getElementById('alerts').style.display = 'none';
            document.querySelector('main').style.display = 'none';
            document.getElementById('education').style.display = 'none';
            document.getElementById('portfolio').style.display = 'block';
            
            loadPortfolio();

            startPriceUpdates();
        }
        
        async function loadPortfolio() {
    try {
        const response = await fetch(`${API_URL}/api/portfolio`, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });
        
        if (!response.ok) throw new Error('Failed to load portfolio');
        
        const data = await response.json();
        const trades = data.trades || [];
        
        const container = document.getElementById('portfolioContainer');
        
        if (trades.length === 0) {
            container.innerHTML = `
                <div class="glass rounded-2xl p-16 text-center">
                    <div class="text-8xl mb-6">üìä</div>
                    <h3 class="text-3xl font-black mb-3">No Trades Yet</h3>
                    <p class="text-xl text-slate-400 mb-6">Start adding trade ideas from the alerts!</p>
                    <button onclick="showSection('alerts')" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-700 transition">
                        Browse Alerts
                    </button>
                </div>
            `;
            return;
        }
        
        // Calculate overall stats
        const closedTrades = trades.filter(t => t.status === 'closed');
        const openTrades = trades.filter(t => t.status === 'open');
        const winningTrades = closedTrades.filter(t => t.pnl_percent > 0);
        const winRate = closedTrades.length > 0 ? (winningTrades.length / closedTrades.length * 100) : 0;
        const totalPnL = closedTrades.reduce((sum, t) => sum + (t.pnl_dollars || 0), 0);
        
        container.innerHTML = `
            <!-- Performance Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="glass rounded-xl p-6 text-center">
                    <div class="text-3xl font-black gradient-text">${trades.length}</div>
                    <div class="text-sm text-slate-400 mt-1">Total Trades</div>
                </div>
                <div class="glass rounded-xl p-6 text-center">
                    <div class="text-3xl font-black text-yellow-400">${openTrades.length}</div>
                    <div class="text-sm text-slate-400 mt-1">Open Positions</div>
                </div>
                <div class="glass rounded-xl p-6 text-center">
                    <div class="text-3xl font-black ${winRate >= 50 ? 'text-green-400' : 'text-red-400'}">${winRate.toFixed(0)}%</div>
                    <div class="text-sm text-slate-400 mt-1">Win Rate</div>
                </div>
                <div class="glass rounded-xl p-6 text-center">
                    <div class="text-3xl font-black ${totalPnL >= 0 ? 'text-green-400' : 'text-red-400'}">
                        ${totalPnL >= 0 ? '+' : ''}$${totalPnL.toFixed(2)}
                    </div>
                    <div class="text-sm text-slate-400 mt-1">Total P&L</div>
                </div>
            </div>
            
            <!-- Trades List -->
            ${trades.map(trade => {
                const isOpen = trade.status === 'open';
                const pnlColor = !trade.pnl_percent ? 'text-gray-400' : trade.pnl_percent >= 0 ? 'text-green-400' : 'text-red-400';
                
                return `
                    <div class="glass rounded-xl p-6 mb-4" data-ticker="${trade.ticker}" data-entry-price="${trade.entry_price || 0}" data-quantity="${trade.quantity || 1}" data-direction="${trade.direction}">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-2xl font-bold">${trade.ticker} <span class="live-price text-lg text-gray-400"></span></h3>
                                    <p class="text-sm price-change"></p>
                                <p class="text-sm text-gray-400">Added ${timeAgo(trade.created_at)}</p>
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="${trade.direction === 'bullish' || trade.direction === 'long' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'} px-4 py-2 rounded-full font-bold text-sm">
                                    ${(trade.direction || 'neutral').toUpperCase()}
                                </span>
                                <span class="${isOpen ? 'bg-yellow-500/20 text-yellow-400' : 'bg-blue-500/20 text-blue-400'} px-4 py-2 rounded-full font-bold text-sm">
                                    ${trade.status.toUpperCase()}
                                </span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-4">
                            <div class="bg-slate-800/50 rounded-lg p-3">
                                <p class="text-xs text-gray-500 mb-1">Entry</p>
                                <p class="text-sm font-bold">${trade.entry_price ? '$' + trade.entry_price.toFixed(2) : 'N/A'}</p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-3">
                                <p class="text-xs text-gray-500 mb-1">Exit</p>
                                <p class="text-sm font-bold ${trade.exit_price ? 'text-white' : 'text-gray-600'}">
                                    ${trade.exit_price ? '$' + trade.exit_price.toFixed(2) : '-'}
                                </p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-3">
                                <p class="text-xs text-gray-500 mb-1">Quantity</p>
                                <p class="text-sm font-bold">${trade.quantity || 1}</p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-3">
                                <p class="text-xs text-gray-500 mb-1">P&L %</p>
                                <p class="text-sm font-bold ${pnlColor}">
                                    ${trade.pnl_percent ? (trade.pnl_percent >= 0 ? '+' : '') + trade.pnl_percent.toFixed(2) + '%' : '-'}
                                </p>
                                <p class="text-xs text-gray-500 mt-1">Live: <span class="unrealized-pnl-percent"></span></p>
                            </div>
                            <div class="bg-slate-800/50 rounded-lg p-3">
                                <p class="text-xs text-gray-500 mb-1">P&L $</p>
                                <p class="text-sm font-bold ${pnlColor}">
                                    ${trade.pnl_dollars ? (trade.pnl_dollars >= 0 ? '+$' : '-$') + Math.abs(trade.pnl_dollars).toFixed(2) : '-'}
                                </p>
                                <p class="text-xs text-gray-500 mt-1">Live: <span class="unrealized-pnl-dollars"></span></p>
                            </div>
                        </div>
                        
                        <p class="text-sm text-gray-300 mb-3">
                            <strong>Strategy:</strong> ${trade.strategy || 'N/A'}
                        </p>
                        
                        ${trade.notes ? `
                            <p class="text-sm text-gray-400 mb-3 italic">üìù ${trade.notes}</p>
                        ` : ''}
                        
                        <div class="flex gap-3">
                            ${isOpen ? `
                                <button onclick="openExitTradeModal('${trade.id}')" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm font-semibold transition">
                                    üí∞ Exit Trade
                                </button>
                            ` : ''}
                            <button onclick="removeFromPortfolio('${trade.id}')" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm font-semibold transition">
                                üóëÔ∏è Remove
                            </button>
                        </div>
                    </div>
                `;
            }).join('')}
        `;
        
    } catch (error) {
        showToast('Failed to load portfolio');
        console.error(error);
    }
}
        
        async function addToPortfolio(alertIndex, tradeIndex) {
    if (!authToken) {
        showToast('Please login to track trades');
        openAuthModal();
        return;
    }
    
    try {
        const alert = allAlerts[alertIndex];
        
        if (!alert || !alert.id) {
            showToast('‚ùå Alert not found or missing ID');
            console.error('Alert issue:', alert);
            return;
        }
        
        const response = await fetch(`${API_URL}/api/portfolio/add`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({
                alert_id: alert.id,
                trade_idea_index: tradeIndex,
                entry_price: null,
                quantity: 1,
                notes: null
            })
        });
        
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || 'Failed to add to portfolio');
        }
        
        showToast('‚úÖ Added to portfolio!');
        
    } catch (error) {
        const errorMessage = error.message || 'Failed to add to portfolio';
        showToast('‚ùå ' + errorMessage);
        console.error('Add to portfolio error:', error);
    }
}
        
        async function removeFromPortfolio(tradeId) {
            if (!confirm('Remove this trade from your portfolio?')) return;
            
            try {
                const response = await fetch(`${API_URL}/api/portfolio/${tradeId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (!response.ok) throw new Error('Failed to remove');
                
                showToast('Removed from portfolio');
                loadPortfolio();
            } catch (error) {
                showToast('Failed to remove trade');
            }
        }
        
        // ==================== APP FUNCTIONS ====================
        
        function connectTelegram() {
            alert('ü§ñ To connect Telegram:\n\n1. Open Telegram\n2. Search for your bot\n3. Send /start\n\nYou\'ll receive alerts instantly!');
        }
        
        function timeAgo(timestamp) {
            const now = Date.now();
            const diff = now - new Date(timestamp).getTime();
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (seconds < 60) return 'just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }
        
        function setFilter(type, value) {
            if (type === 'category') {
                currentCategoryFilter = value;
                document.querySelectorAll('.filter-chip').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-filter="${value}"]`).classList.add('active');
            } else if (type === 'sector') {
                currentSectorFilter = value;
                document.querySelectorAll('.sector-chip').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-sector="${value}"]`).classList.add('active');
            }
            filterAlerts();
        }
        
        function sortAlerts() {
            currentSort = document.getElementById('sortSelect').value;
            filterAlerts();
        }
        
        function matchesSector(alert, sector) {
            if (sector === 'all') return true;
            const tickers = sectorMapping[sector] || [];
            
            // Check trade_ideas array
            if (alert.trade_ideas && alert.trade_ideas.length > 0) {
                return alert.trade_ideas.some(trade => tickers.includes(trade.ticker));
            }
            
            // Fallback to old structure
            const alertTicker = alert.trade_idea?.ticker;
            const affectedTickers = (alert.affected_assets || []).map(a => a.ticker);
            return tickers.includes(alertTicker) || affectedTickers.some(t => tickers.includes(t));
        }
        
        function filterAlerts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let filtered = allAlerts.filter(alert => {
                const event = alert.event || {};
                const matchesCategory = currentCategoryFilter === 'all' || event.category === currentCategoryFilter;
                const matchesSectorFilter = matchesSector(alert, currentSectorFilter);
                
                let matchesSearch = !searchTerm;
                if (searchTerm) {
                    matchesSearch = event.headline?.toLowerCase().includes(searchTerm);
                    
                    if (!matchesSearch && alert.trade_ideas) {
                        matchesSearch = alert.trade_ideas.some(t => t.ticker.toLowerCase().includes(searchTerm));
                    }
                    
                    if (!matchesSearch && alert.affected_assets) {
                        matchesSearch = alert.affected_assets.some(a => a.ticker.toLowerCase().includes(searchTerm));
                    }
                }
                
                return matchesCategory && matchesSectorFilter && matchesSearch;
            });
            
            // Sort
            if (currentSort === 'newest') {
                filtered.sort((a, b) => new Date(b.event?.detected_at || 0) - new Date(a.event?.detected_at || 0));
            } else if (currentSort === 'oldest') {
                filtered.sort((a, b) => new Date(a.event?.detected_at || 0) - new Date(b.event?.detected_at || 0));
            } else if (currentSort === 'relevance') {
                filtered.sort((a, b) => (b.event?.confidence || 0) - (a.event?.confidence || 0));
            }
            
            renderAlerts(filtered);
        }
        
        async function loadAlerts(showNotification = false) {
            try {
                const response = await fetch(`${API_URL}/api/alerts`);
                const data = await response.json();
                const newAlerts = data.alerts || [];
                
                const existingIds = new Set(allAlerts.map(a => a.event?.headline + a.event?.detected_at));
                const trulyNewAlerts = newAlerts.filter(alert => {
                    const id = alert.event?.headline + alert.event?.detected_at;
                    return !existingIds.has(id);
                });
                
                if (showNotification && trulyNewAlerts.length > 0) {
                    showToast(`${trulyNewAlerts.length} new alert${trulyNewAlerts.length > 1 ? 's' : ''} received!`);
                }
                
                allAlerts = [...trulyNewAlerts, ...allAlerts];
                
                // Remove alerts older than 24 hours
                const oneDayAgo = Date.now() - (24 * 60 * 60 * 1000);
                allAlerts = allAlerts.filter(alert => {
                    const alertTime = new Date(alert.event?.detected_at || Date.now()).getTime();
                    return alertTime > oneDayAgo;
                });
                
                lastFetchTime = Date.now();
                
                document.getElementById('countNum').textContent = allAlerts.length;
                document.getElementById('heroAlertCount').textContent = allAlerts.length;
                document.getElementById('updateTime').textContent = timeAgo(lastFetchTime);
                
                filterAlerts();
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        function toggleAlert(id) {
            const details = document.getElementById(`details-${id}`);
            const btn = document.getElementById(`btn-${id}`);
            
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                btn.innerHTML = 'üìä View Analysis & Trade Ideas';
            } else {
                details.classList.add('expanded');
                btn.innerHTML = '‚ñ≤ Hide Analysis';
            }
        }
        
        function renderAlerts(alerts) {
            const container = document.getElementById('alertsContainer');
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <div class="glass rounded-2xl p-16 text-center">
                        <div class="text-8xl mb-6">üî≠</div>
                        <h3 class="text-3xl font-black mb-3">No Matching Alerts</h3>
                        <p class="text-xl text-slate-400">Try adjusting your filters or search</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = alerts.map((alert, index) => {
                const event = alert.event || {};
                const tradeIdeas = alert.trade_ideas || [];
                const whyItMatters = alert.why_it_matters || [];
                const confidence = Math.round((event.confidence || 0) * 100);
                const timestamp = event.detected_at || new Date().toISOString();
                const primaryDirection = event.primary_direction || 'neutral';
                
                return `
                    <div class="card glass rounded-2xl overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-600/20 to-purple-600/20 p-6 border-b border-slate-700/50">
                            <div class="flex items-start justify-between gap-4 mb-3">
                                <h3 class="text-xl font-bold flex-1 leading-tight">${event.headline || 'Breaking News'}</h3>
                                <div class="text-sm text-slate-400">${timeAgo(timestamp)}</div>
                            </div>
                            <div class="flex gap-2 flex-wrap mb-4">
                                <span class="bg-slate-800/80 px-3 py-1 rounded-full text-xs font-semibold">${event.category || 'general'}</span>
                                <span class="${
                                    primaryDirection === 'bullish' ? 'bg-green-600/30 text-green-300 border-green-500/40' : 
                                    primaryDirection === 'bearish' ? 'bg-red-600/30 text-red-300 border-red-500/40' : 
                                    'bg-gray-600/30 text-gray-300 border-gray-500/40'
                                } border px-3 py-1 rounded-full text-xs font-bold">
                                    ${primaryDirection === 'bullish' ? 'üìà BULLISH' : primaryDirection === 'bearish' ? 'üìâ BEARISH' : '‚ûñ NEUTRAL'}
                                </span>
                                <span class="bg-green-500/20 text-green-400 border border-green-500/30 px-3 py-1 rounded-full text-xs font-bold">${confidence}% confidence</span>
                                ${tradeIdeas.length > 0 ? `<span class="bg-purple-600 px-3 py-1 rounded-full text-xs font-bold">${tradeIdeas.length} Trade Ideas</span>` : ''}
                            </div>
                            <button 
                                id="btn-${index}"
                                onclick="toggleAlert(${index})" 
                                class="bg-blue-600 hover:bg-blue-700 px-6 py-2.5 rounded-lg font-semibold transition-all text-sm w-full md:w-auto"
                            >
                                üìä View Analysis & Trade Ideas
                            </button>
                        </div>
                        
                        <div id="details-${index}" class="alert-details">
                            <div class="p-6 space-y-6">
                                ${whyItMatters.length > 0 ? `
                                    <div class="bg-slate-800/40 rounded-xl p-4">
                                        <h4 class="font-bold mb-3 flex items-center gap-2">
                                            <span class="text-xl">üí°</span>
                                            Why It Matters
                                        </h4>
                                        <ul class="space-y-2 text-slate-300 text-sm">
                                            ${whyItMatters.map(point => `
                                                <li class="flex gap-2">
                                                    <span class="text-blue-400 flex-shrink-0">‚Ä¢</span>
                                                    <span>${point}</span>
                                                </li>
                                            `).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                
                                ${tradeIdeas.length > 0 ? `
                                    <div>
                                        <h4 class="font-bold text-lg mb-4 flex items-center gap-2">
                                            <span class="text-xl">üéØ</span>
                                            Trade Ideas (${tradeIdeas.length})
                                        </h4>
                                        <div class="space-y-4">
                                            ${tradeIdeas.map((trade, i) => {
                                                const isBullish = trade.direction === 'bullish' || trade.direction === 'long';
                                                const convictionColor = 
                                                    trade.conviction === 'high' ? 'text-green-400' :
                                                    trade.conviction === 'medium' ? 'text-yellow-400' :
                                                    'text-orange-400';
                                                
                                                return `
                                                    <div class="bg-gradient-to-br from-slate-800/60 to-slate-800/40 rounded-xl p-5 border border-slate-700/50">
                                                        <div class="flex items-center justify-between mb-3 flex-wrap gap-2">
                                                            <div class="flex items-center gap-3">
                                                                <span class="font-mono font-black text-2xl">${trade.ticker}</span>
                                                                <span class="${isBullish ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'} px-3 py-1 rounded-full text-xs font-bold">
                                                                    ${(trade.direction || 'neutral').toUpperCase()}
                                                                </span>
                                                                <span class="${convictionColor} text-xs font-bold">${(trade.conviction || 'medium').toUpperCase()}</span>
                                                            </div>
                                                            
                                                            ${currentUser ? `
                                                                <button onclick="addToPortfolio(${index}, ${i})" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-semibold rounded-lg hover:from-blue-600 hover:to-purple-700 transition">
                                                                    + Add to Portfolio
                                                                </button>
                                                            ` : ''}
                                                        </div>
                                                        
                                                        <p class="text-sm text-gray-300 mb-3"><strong>Strategy:</strong> ${trade.strategy || 'N/A'}</p>
                                                        
                                                        ${trade.entry_price ? `
                                                            <div class="grid grid-cols-4 gap-3 mb-3">
                                                                <div class="bg-gray-800 rounded-lg p-3">
                                                                    <p class="text-xs text-gray-500 mb-1">Entry</p>
                                                                    <p class="text-sm font-bold text-white">${trade.entry_price}</p>
                                                                </div>
                                                                <div class="bg-gray-800 rounded-lg p-3">
                                                                    <p class="text-xs text-gray-500 mb-1">Target</p>
                                                                    <p class="text-sm font-bold text-green-400">${trade.target_price || 'N/A'}</p>
                                                                </div>
                                                                <div class="bg-gray-800 rounded-lg p-3">
                                                                    <p class="text-xs text-gray-500 mb-1">Stop Loss</p>
                                                                    <p class="text-sm font-bold text-red-400">${trade.stop_loss || 'N/A'}</p>
                                                                </div>
                                                                <div class="bg-gray-800 rounded-lg p-3">
                                                                    <p class="text-xs text-gray-500 mb-1">R/R</p>
                                                                    <p class="text-sm font-bold text-blue-400">${trade.risk_reward_ratio || 'N/A'}</p>
                                                                </div>
                                                            </div>
                                                        ` : ''}
                                                        
                                                        <div class="bg-slate-900/50 rounded-lg p-3">
                                                            <p class="text-xs text-gray-400"><strong>Rationale:</strong> ${trade.rationale || 'N/A'}</p>
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${!currentUser && tradeIdeas.length > 0 ? `
                                    <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                        <p class="text-sm text-blue-300">
                                            üí° <strong>Login to track these trades</strong> and see your portfolio performance!
                                            <button onclick="openAuthModal()" class="ml-2 underline hover:text-blue-200">Login now</button>
                                        </p>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-xl shadow-2xl z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // ==================== EDUCATION FUNCTIONS ====================
        
        function showCourse(courseId) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[data-tab="${courseId}"]`).classList.add('active');
            document.getElementById(`course-${courseId}`).classList.add('active');
        }
        
        function checkAnswer(quizId, selected, isCorrect) {
            const quiz = document.getElementById(`quiz${quizId}`);
            const answerDiv = document.getElementById(`answer${quizId}`);
            const options = quiz.querySelectorAll('.quiz-option');
            
            options.forEach(opt => {
                opt.onclick = null;
                if (opt.textContent.trim().startsWith(selected)) {
                    opt.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            });

            const answers = {
                1: {
                    correct: '‚úÖ <strong>Correct!</strong> Fed policy shifts have the broadest market impact, affecting everything from bond yields to currency values to equity valuations.',
                    incorrect: '‚ùå <strong>Not quite.</strong> The correct answer is C. Fed policy changes affect the entire financial system, making them the highest-impact events.'
                },
                2: {
                    correct: '‚úÖ <strong>Correct!</strong> Put options give you the right to SELL at the strike price, so they increase in value when the stock drops. Perfect for bearish news plays.',
                    incorrect: '‚ùå <strong>Not quite.</strong> The correct answer is B. Put options profit when stocks fall, making them ideal for bearish predictions.'
                },
                3: {
                    correct: '‚úÖ <strong>Correct!</strong> Copper futures have no direct connection to pharmaceutical company approvals. The impact is confined to healthcare sector.',
                    incorrect: '‚ùå <strong>Not quite.</strong> The correct answer is C. Commodities like copper are unrelated to pharma news - focus on sector-specific impacts.'
                },
                4: {
                    correct: '‚úÖ <strong>Correct!</strong> Bull call spreads offer defined risk with lower cost than buying calls outright. Perfect for moderate bullish moves while protecting against IV crush.',
                    incorrect: '‚ùå <strong>Not quite.</strong> The correct answer is B. Spreads reduce cost and risk while still capturing upside - ideal for moderate expectations.'
                }
            };

            if (isCorrect) {
                answerDiv.className = 'mt-3 bg-green-900/20 border border-green-500/30 rounded-lg p-3 text-green-300';
                answerDiv.innerHTML = answers[quizId].correct;
                progress.quizzesPassed++;
                updateProgress();
            } else {
                answerDiv.className = 'mt-3 bg-red-900/20 border border-red-500/30 rounded-lg p-3 text-red-300';
                answerDiv.innerHTML = answers[quizId].incorrect;
            }
            
            answerDiv.classList.remove('hidden');
        }
        
        function completeLesson(course, lessonNum) {
            progress[course] = Math.max(progress[course], lessonNum + 1);
            updateProgress();
            showToast(`Lesson completed! Great job! üéâ`);
        }
        
        function updateProgress() {
            const totalLessons = 16;
            const completed = progress.fundamentals + progress.analysis + progress.trading + progress.options + progress.risk;
            const percentage = Math.round((completed / totalLessons) * 100);
            
            document.getElementById('totalProgress').textContent = percentage + '%';
            document.getElementById('lessonsCompleted').textContent = `${completed}/${totalLessons}`;
            document.getElementById('quizzesPassed').textContent = `${progress.quizzesPassed}/4`;
            document.getElementById('videosWatched').textContent = `${progress.videosWatched.length}/12`;
            
            // Update individual course progress
            const courses = ['fundamentals', 'analysis', 'trading', 'options'];
            courses.forEach(course => {
                const prog = progress[course] || 0;
                document.getElementById(`prog-${course}`).textContent = `${prog}/4`;
                document.getElementById(`bar-${course}`).style.width = (prog / 4 * 100) + '%';
            });
        }
        
        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress?')) {
                progress = {
                    fundamentals: 0,
                    analysis: 0,
                    trading: 0,
                    options: 0,
                    risk: 0,
                    quizzesPassed: 0,
                    videosWatched: []
                };
                updateProgress();
                showToast('Progress reset successfully');
            }
        }
        
        function watchVideo(videoId) {
            if (!progress.videosWatched.includes(videoId)) {
                progress.videosWatched.push(videoId);
                updateProgress();
            }
            
            const statusEl = document.getElementById(`video-${videoId}-status`);
            if (statusEl) {
                statusEl.textContent = '‚úì Watched';
                statusEl.className = 'text-xs text-green-400';
            }
            
            showToast('Video marked as watched! üé•');
        }
        
        function calculateProfit() {
            const optionType = document.getElementById('optionType').value;
            const stockPrice = parseFloat(document.getElementById('stockPrice').value) || 0;
            const strikePrice = parseFloat(document.getElementById('strikePrice').value) || 0;
            const premium = parseFloat(document.getElementById('premium').value) || 0;
            const contracts = parseInt(document.getElementById('contracts').value) || 0;
            const targetPrice = parseFloat(document.getElementById('targetPrice').value) || 0;

            const totalInvestment = premium * 100 * contracts;
            
            let breakeven, intrinsicValue, profitLoss;
            
            if (optionType === 'call') {
                breakeven = strikePrice + premium;
                intrinsicValue = Math.max(0, targetPrice - strikePrice);
                
                const moneyness = (stockPrice - strikePrice) / stockPrice;
                let delta = 0.5;
                if (moneyness > 0.05) delta = 0.7;
                else if (moneyness < -0.05) delta = 0.3;
                
                document.getElementById('deltaCalc').textContent = delta.toFixed(2);
            } else {
                breakeven = strikePrice - premium;
                intrinsicValue = Math.max(0, strikePrice - targetPrice);
                
                const moneyness = (strikePrice - stockPrice) / stockPrice;
                let delta = -0.5;
                if (moneyness > 0.05) delta = -0.7;
                else if (moneyness < -0.05) delta = -0.3;
                
                document.getElementById('deltaCalc').textContent = delta.toFixed(2);
            }
            
            const totalValue = intrinsicValue * 100 * contracts;
            profitLoss = totalValue - totalInvestment;
            const returnPct = totalInvestment > 0 ? (profitLoss / totalInvestment * 100) : 0;

            // Update display
            document.getElementById('totalInvestment').textContent = `$${totalInvestment.toFixed(2)}`;
            document.getElementById('breakeven').textContent = `$${breakeven.toFixed(2)}`;
            document.getElementById('targetValue').textContent = `$${totalValue.toFixed(2)}`;
            document.getElementById('profitLoss').textContent = `$${profitLoss.toFixed(2)}`;
            document.getElementById('returnPct').textContent = `${returnPct > 0 ? '+' : ''}${returnPct.toFixed(1)}%`;
            
            // Color coding
            const profitBox = document.getElementById('profitLossBox');
            if (profitLoss > 0) {
                profitBox.className = 'bg-green-900/20 border border-green-500/30 rounded-lg p-4';
                document.getElementById('profitLoss').className = 'text-3xl font-black text-green-400';
                document.getElementById('returnPct').className = 'text-sm mt-1 text-green-400';
            } else if (profitLoss < 0) {
                profitBox.className = 'bg-red-900/20 border border-red-500/30 rounded-lg p-4';
                document.getElementById('profitLoss').className = 'text-3xl font-black text-red-400';
                document.getElementById('returnPct').className = 'text-sm mt-1 text-red-400';
            } else {
                profitBox.className = 'bg-slate-800/50 rounded-lg p-4';
                document.getElementById('profitLoss').className = 'text-3xl font-black';
                document.getElementById('returnPct').className = 'text-sm mt-1';
            }

            // Simplified Greeks
            document.getElementById('thetaCalc').textContent = '-' + (premium * 0.03).toFixed(2);
            document.getElementById('gammaCalc').textContent = (0.05).toFixed(2);
            document.getElementById('maxRisk').textContent = '$' + totalInvestment.toFixed(0);
        }
        
        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const userMenuContainer = document.getElementById('userMenuContainer');
            const userMenu = document.getElementById('userMenu');
            
            if (userMenuContainer && !userMenuContainer.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });
        
        // Update "time ago" every 30 seconds
        setInterval(() => {
            document.getElementById('updateTime').textContent = timeAgo(lastFetchTime);
        }, 30000);


        // ==================== REAL-TIME PRICES ====================
        
        let priceCache = {};
        let priceUpdateInterval = null;
        
        async function fetchPrices(tickers) {
            if (!tickers || tickers.length === 0) return {};
            
            const uniqueTickers = [...new Set(tickers)].filter(t => t && t !== 'N/A' && t !== 'TBD');
            
            if (uniqueTickers.length === 0) return {};
            
            try {
                const response = await fetch(`${API_URL}/api/prices?tickers=${uniqueTickers.join(',')}`);
                const data = await response.json();
                
                // Update cache
                priceCache = { ...priceCache, ...data.prices };
                
                return data.prices;
            } catch (error) {
                console.error('Error fetching prices:', error);
                return {};
            }
        }
        
        function formatPrice(price) {
            if (!price || price === 0) return 'N/A';
            return '$' + price.toFixed(2);
        }
        
        function formatPriceChange(change, changePercent) {
            if (change === undefined || change === null) return '';
            
            const symbol = change >= 0 ? '‚Üë' : '‚Üì';
            const color = change >= 0 ? 'text-green-400' : 'text-red-400';
            
            return `<span class="${color}">${symbol} ${Math.abs(changePercent || 0).toFixed(2)}%</span>`;
        }
        
        async function updateAllPrices() {
            // Get all tickers from current view
            const tickers = [];
            
            // Get tickers from alerts
            if (currentSection === 'alerts') {
                allAlerts.forEach(alert => {
                    if (alert.trade_ideas) {
                        alert.trade_ideas.forEach(trade => {
                            if (trade.ticker && trade.ticker !== 'TBD') {
                                tickers.push(trade.ticker);
                            }
                        });
                    }
                });
            }
            
            // Get tickers from portfolio
            if (currentSection === 'portfolio') {
                const portfolioTickers = document.querySelectorAll('[data-ticker]');
                portfolioTickers.forEach(el => {
                    const ticker = el.getAttribute('data-ticker');
                    if (ticker && ticker !== 'TBD') tickers.push(ticker);
                });
            }
            
            if (tickers.length === 0) return;
            
            const prices = await fetchPrices(tickers);
            
            // Update price displays
            Object.keys(prices).forEach(ticker => {
                const priceData = prices[ticker];
                const elements = document.querySelectorAll(`[data-ticker="${ticker}"]`);
                
                elements.forEach(el => {
                    const priceSpan = el.querySelector('.live-price');
                    const changeSpan = el.querySelector('.price-change');
                    
                    if (priceSpan && priceData.price) {
                        priceSpan.textContent = formatPrice(priceData.price);
                    }
                    
                    if (changeSpan && priceData.change !== undefined) {
                        changeSpan.innerHTML = formatPriceChange(priceData.change, priceData.change_percent);
                    }
                    
                    // Update unrealized P&L for portfolio
                    if (currentSection === 'portfolio') {
                        updateUnrealizedPnL(el, priceData.price);
                    }
                });
            });
        }
        
        function updateUnrealizedPnL(element, currentPrice) {
            const entryPrice = parseFloat(element.getAttribute('data-entry-price'));
            const quantity = parseFloat(element.getAttribute('data-quantity') || 1);
            const direction = element.getAttribute('data-direction');
            
            if (!entryPrice || !currentPrice) return;
            
            let pnlDollars, pnlPercent;
            
            if (direction === 'long' || direction === 'bullish') {
                pnlDollars = (currentPrice - entryPrice) * quantity;
                pnlPercent = ((currentPrice - entryPrice) / entryPrice) * 100;
            } else {
                pnlDollars = (entryPrice - currentPrice) * quantity;
                pnlPercent = ((entryPrice - currentPrice) / entryPrice) * 100;
            }
            
            const pnlDollarEl = element.querySelector('.unrealized-pnl-dollars');
            const pnlPercentEl = element.querySelector('.unrealized-pnl-percent');
            
            const color = pnlDollars >= 0 ? 'text-green-400' : 'text-red-400';
            
            if (pnlDollarEl) {
                pnlDollarEl.className = `unrealized-pnl-dollars font-bold ${color}`;
                pnlDollarEl.textContent = (pnlDollars >= 0 ? '+$' : '-$') + Math.abs(pnlDollars).toFixed(2);
            }
            
            if (pnlPercentEl) {
                pnlPercentEl.className = `unrealized-pnl-percent font-bold ${color}`;
                pnlPercentEl.textContent = (pnlPercent >= 0 ? '+' : '') + pnlPercent.toFixed(2) + '%';
            }
        }
        
        function startPriceUpdates() {
            // Stop existing interval
            if (priceUpdateInterval) {
                clearInterval(priceUpdateInterval);
            }
            
            // Update immediately
            updateAllPrices();
            
            // Update every 30 seconds
            priceUpdateInterval = setInterval(updateAllPrices, 30000);
        }
        
        function stopPriceUpdates() {
            if (priceUpdateInterval) {
                clearInterval(priceUpdateInterval);
                priceUpdateInterval = null;
            }
        }
        // ==================== INITIALIZE ====================
        initAuth();
        loadAlerts();
        updateProgress();
        
        // Auto-refresh alerts every 15 seconds
        setInterval(() => loadAlerts(true), 15000);
    </script>
</body>
</html>
